<script>
tst();
function tst(){
  var playlistId = "PL52duCjXJ6e5Iqw-JJEjraIEkmUwC2Zm0";


  $.ajax({
    type: 'POST',
    url: "/api/youtube/"+ playlistId +"/import",
    cache: false,
    success: function(data){
      $('#dialog .box .subtitle').text('Playlist was successfully imported.');
    },
    error: function(error){
      const data = JSON.parse(error.responseText);
      $('#dialog .box .subtitle').removeClass('green').addClass('red').text('Error: '+ data.error);
    }
  });
}
</script>


/***********************************************************************************************/
/***********************************************************************************************/
/***********************************************************************************************/
/***********************************************************************************************/
SERVER

app.post('/api/youtube/:ypid/import', async (req, res) => {
  const userID = req.session.userID;

  if(userID){
    const youtubeplaylistid = req.params.ypid;

    const fs = require('fs');
    let data = fs.readFileSync('playlist.json');
    data = JSON.parse(data);

    if(youtubeplaylistid == data.items[0].snippet.playlistId){ // Ak exisuje playlist

      if(data.items.length > 0){ // Ak je nejaká pesnička v danom playliste
        const arr = [];

        await Promise.all(data.items.map(async (song) => {
          arr.push({id: song.snippet.resourceId.videoId, name: song.snippet.title});
        }));

        res.status(200).json({status: 200, song: arr});
      }

      else{
        res.status(404).json({status: 404, error: 'This playlist haven\'t any songs.'})
      }

    }

    else{
      res.status(404).json({status: 404, error: 'This playlist doens\'t exist.'})
    }

  }

});
